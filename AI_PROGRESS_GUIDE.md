# AI 生成义项进度显示功能

## 功能概述

详细展示 AI 自动生成义项的全过程，包括实时进度、找到的字符、生成的义项等信息。

## 进度阶段

### 阶段 1：找出重点字
- **图标**：数字 1，圆形背景
- **状态**：分析所有句子，找出需要制作义项的重点字
- **显示**：
  - 当前处理的句子数量
  - 找到的重点字列表（实时更新）
  - 字符标签：青绿色背景，加粗显示

### 阶段 2：生成义项
- **图标**：数字 2，圆形背景
- **状态**：为每个重点字生成义项
- **显示**：
  - 进度条：显示当前进度和总数
  - 当前处理的字符和句子
  - 已生成的义项列表（最近 10 个）
  - 每个义项显示：字、义项内容、例句

### 阶段 3：保存到库
- **图标**：数字 3，圆形背景
- **状态**：保存义项到义项库
- **显示**：
  - 保存进度
  - 新增数量
  - 跳过的重复义项数量

## UI 设计

### 阶段指示器
```
┌─────┐    ┌─────┐    ┌─────┐
│  1  │ →  │  2  │ →  │  3  │
└─────┘    └─────┘    └─────┘
找重点字    生成义项    保存到库
```

- **未激活**：灰色，透明度 40%
- **激活中**：青绿色，发光效果，脉动动画
- **已完成**：绿色，透明度 70%

### 进度条
- **轨道**：浅青绿色背景
- **填充**：渐变色（青绿 → 绿色）
- **动画**：闪烁效果
- **标签**：显示当前任务和进度数字

### 找到的重点字
- **布局**：标签云，自动换行
- **样式**：
  - 背景：青绿色 20% 透明度
  - 边框：青绿色 40% 透明度
  - 字体：宋体，加粗
  - 动画：从左滑入

### 已生成的义项
- **布局**：列表，最多显示 10 个
- **每项包含**：
  - 字符：方形图标，青绿色背景
  - 义项：绿色背景标签
  - 例句：灰色文本，截断显示
- **滚动**：超过 10 个显示滚动条
- **动画**：新项目从左滑入

## 数据结构

```typescript
interface AIProgress {
  stage: 'finding' | 'generating' | 'saving' | '';
  current: number;
  total: number;
  currentSentence: string;
  foundCharacters: string[];
  generatedDefinitions: Array<{
    character: string;
    definition: string;
    sentence: string;
  }>;
}
```

## 实时更新机制

### 第一轮：找重点字
1. 发送所有句子到 AI
2. AI 返回每个句子的重点字
3. 实时更新 `foundCharacters` 数组
4. 显示字符标签

### 第二轮：生成义项
1. 分批处理（每批 5 个）
2. 每批完成后更新进度
3. 实时添加到 `generatedDefinitions` 数组
4. 显示最近 10 个义项
5. 批次间延迟 1 秒，避免请求过快

### 第三轮：保存到库
1. 检查重复义项
2. 保存新义项
3. 关联到句子
4. 显示统计信息

## 完成提示

生成完成后：
- 显示最终统计：新增 X 个，跳过 Y 个
- 3 秒后自动关闭进度显示
- 用户可以立即开始出题

## 错误处理

- **网络错误**：显示错误消息，保留已生成的义项
- **AI 返回错误**：跳过该项，继续处理
- **保存失败**：显示错误，但不影响已保存的义项

## 性能优化

1. **分批处理**：每批 5 个请求，避免超时
2. **延迟控制**：批次间延迟 1 秒
3. **只显示最近 10 个**：避免 DOM 过大
4. **虚拟滚动**：超过 10 个使用滚动
5. **动画优化**：使用 CSS 动画，GPU 加速

## 用户体验

### 视觉反馈
- ✅ 阶段切换：平滑过渡
- ✅ 进度条：实时更新
- ✅ 新项目：滑入动画
- ✅ 激活状态：发光脉动

### 信息展示
- ✅ 当前任务：清晰描述
- ✅ 进度数字：X / Y 格式
- ✅ 找到的字：标签云
- ✅ 生成的义项：列表展示

### 交互设计
- ✅ 自动滚动：新项目自动滚动到视图
- ✅ 自动关闭：完成后 3 秒关闭
- ✅ 可中断：用户可以刷新页面中断

## 示例流程

```
1. 用户点击"AI自动生成义项"

2. 阶段 1 激活
   ┌─────────────────────────────┐
   │ 找出重点字                   │
   │ 正在分析句子...              │
   │                             │
   │ 找到的重点字 (15)            │
   │ [学] [而] [时] [习] [之]...  │
   └─────────────────────────────┘

3. 阶段 2 激活
   ┌─────────────────────────────┐
   │ 生成义项                     │
   │ 正在处理: 学 (学而时习之...)  │
   │ ████████░░░░░░░░ 8 / 15     │
   │                             │
   │ 已生成的义项 (8)             │
   │ [学] 学习  学而时习之...     │
   │ [而] 连词  学而时习之...     │
   │ ...                         │
   └─────────────────────────────┘

4. 阶段 3 激活
   ┌─────────────────────────────┐
   │ 保存到库                     │
   │ 正在保存到义项库...          │
   └─────────────────────────────┘

5. 完成
   ┌─────────────────────────────┐
   │ 完成！                       │
   │ 新增 12 个义项               │
   │ 跳过 3 个重复义项            │
   └─────────────────────────────┘
   (3秒后自动关闭)
```

## 样式规范

### 颜色
- **主色**：`#4ECDC4` (青绿色)
- **辅色**：`#43E97B` (绿色)
- **成功**：`rgba(67, 233, 123, 0.3)`
- **激活**：`rgba(78, 205, 196, 0.5)`

### 动画
- **淡入**：0.3s ease
- **滑入**：0.3s ease
- **脉动**：1.5s ease-in-out infinite
- **闪烁**：2s infinite

### 间距
- **阶段间距**：1rem
- **标签间距**：0.5rem
- **列表间距**：0.75rem
- **内边距**：1rem - 2rem

## 响应式设计

### 桌面端 (> 768px)
- 阶段横向排列
- 箭头水平指向
- 义项列表双列显示

### 移动端 (≤ 768px)
- 阶段纵向排列
- 箭头垂直指向
- 义项列表单列显示
- 字符标签自动换行

## 可访问性

- ✅ 语义化 HTML
- ✅ ARIA 标签
- ✅ 键盘导航
- ✅ 屏幕阅读器支持
- ✅ 高对比度模式

## 未来改进

1. **暂停/继续**：允许用户暂停生成
2. **取消操作**：允许用户取消生成
3. **导出日志**：导出生成记录
4. **批量编辑**：生成后批量编辑义项
5. **智能去重**：更智能的重复检测

# 自动出题功能使用指南

## 功能概述

自动出题工具可以根据义项库自动生成文言文选择题，支持 AI 自动生成义项。

## 主要功能

### 1. 自动出题

根据已有的义项库，自动生成文言文字义辨析选择题。

#### 题目格式

```
下列句子中"X"字的意思与其他不同的一项是（  ）

A. 句子1（相同义项）
B. 句子2（相同义项）
C. 句子3（相同义项）
D. 句子4（不同义项）← 正确答案
```

#### 配置选项

**必填项：**

1. **题目数量** (1-50)
   - 指定要生成的题目数量
   - 如果可用字符不足，会生成尽可能多的题目

2. **考察范围**
   - 库：选择特定的文言文库
   - 集：选择特定的集（如"七年级上册"）
   - 文章：选择特定的文章
   - 可以只选择库，或库+集，或库+集+文章

**可选项：**

3. **优先考察的字**
   - 输入要优先考察的字，用空格分隔
   - 例如：`学 而 时 习`
   - 系统会优先为这些字生成题目

4. **每题选项数**
   - 3个选项 或 4个选项（默认）

5. **正确答案**
   - 随机（默认）
   - 固定为 A、B、C 或 D

6. **包括之前知识**
   - 勾选后，会包含 order 更小的集
   - 例如：选择"八年级上册"，勾选此项后会同时包含"七年级上册"和"七年级下册"的内容
   - 用于文章内容不足时扩展题库

### 2. AI 自动生成义项

使用 DeepSeek AI 自动为文言文句子生成义项。

#### 工作流程

**第一轮：找出重点字**
- AI 分析句子，找出需要制作义项的重点字
- 只标注单个字，不标注词语
- 排除虚词和常见字

**第二轮：生成义项**
- 为每个重点字生成义项
- 义项只是字的意思，2-4个字
- 自动关联到对应的句子

#### 使用方法

1. 选择考察范围（库/集/文章）
2. 点击"AI自动生成义项"按钮
3. 等待 AI 处理（显示进度）
4. 生成的义项自动保存到义项库

#### 注意事项

- AI 生成需要网络连接
- 处理大量句子时会分批请求，避免超时
- 生成的义项会自动去重
- 如果 AI 返回词语而非单字，会自动过滤

## 使用场景

### 场景 1：为单篇文章出题

1. 选择考察范围：库 → 集 → 文章
2. 设置题目数量：5
3. 点击"生成题目"

### 场景 2：为整个集出题，优先考察特定字

1. 选择考察范围：库 → 集
2. 设置题目数量：10
3. 输入优先考察的字：`学 而 时 习 之`
4. 点击"生成题目"

### 场景 3：文章内容不足，扩展到之前知识

1. 选择考察范围：库 → 八年级上册 → 某篇文章
2. 勾选"包括之前知识"
3. 设置题目数量：10
4. 点击"生成题目"
5. 系统会从七年级上、七年级下、八年级上的内容中选择句子

### 场景 4：批量生成义项

1. 选择考察范围：库 → 集
2. 点击"AI自动生成义项"
3. 等待处理完成
4. 查看生成的义项数量

## 出题算法

### 题目生成逻辑

1. **选择字符**
   - 优先使用用户指定的字符
   - 然后随机选择其他有义项的字符

2. **选择义项**
   - 为每个字符随机选择一个义项作为题目

3. **选择句子**
   - 相同义项：选择 N-1 个例句（N 为选项数）
   - 不同义项：选择 1 个例句
   - 所有句子必须在指定范围内

4. **构建选项**
   - 根据正确答案设置，将不同义项的句子放在指定位置
   - 其他位置放置相同义项的句子

### 范围筛选

- **只选库**：使用该库的所有句子
- **选库+集**：使用该集的所有句子
- **选库+集+文章**：使用该文章的所有句子
- **包括之前知识**：额外包含 order 更小的集

## AI 提示词设计

### 找重点字提示词

```
你是一个文言文专家。请分析以下文言文句子，找出每个句子中需要制作义项的重点字。

规则：
1. 只标注单个字，不要标注词语
2. 重点字是指在文言文中有特殊含义、需要解释的字
3. 不要标注虚词（如：之、乎、者、也等）
4. 不要标注现代汉语中常见的字
5. 每个句子的重点字用"|"分隔

输出格式：
句子1|||字1|字2|字3
句子2|||字1|字2
```

### 生成义项提示词

```
请解释文言文句子中"X"字的意思。

句子：XXXX
字：X

要求：
1. 只输出这个字在这个句子中的意思，2-4个字
2. 不要输出注释、例句或其他解释
3. 如果是多义字，只输出在这个句子中的意思
```

## 导出功能

### Word 导出（开发中）

将生成的题目导出为 Word 文档，格式与示例文档一致。

**计划功能：**
- 自动排版
- 包含题目和答案
- 支持批量导出

## 常见问题

### Q: 为什么生成的题目数量少于设置的数量？

A: 可能的原因：
1. 义项库中可用字符不足
2. 某些字符的例句数量不足（需要至少 N 个例句，N 为选项数）
3. 指定范围内的句子太少

**解决方法：**
- 勾选"包括之前知识"扩展范围
- 使用 AI 生成更多义项
- 减少题目数量

### Q: AI 生成义项失败怎么办？

A: 检查以下几点：
1. 网络连接是否正常
2. API Key 是否有效
3. 选择的范围是否有句子
4. 查看错误提示信息

### Q: 如何确保 AI 生成的义项质量？

A: 系统已经优化：
1. 提示词明确要求只输出 2-4 个字
2. 自动过滤词语，只保留单字
3. 自动去重，避免重复义项
4. 可以手动检查和编辑生成的义项

### Q: 可以自定义题目格式吗？

A: 当前版本题目格式固定为"找出不同义项"。未来版本会支持：
- 找出相同义项
- 多选题
- 填空题

### Q: 如何备份生成的题目？

A: 建议：
1. 使用"导出为 Word"功能（开发中）
2. 截图保存
3. 复制题目文本

## 技术细节

### AI 服务配置

- **API 地址**: `https://api.siliconflow.cn/v1`
- **模型**: `deepseek-ai/DeepSeek-V3.1-Terminus`
- **并发数**: 5 个请求/批次
- **温度**: 0.3（较低，确保稳定输出）
- **最大 Token**: 2000（找重点字）/ 50（生成义项）

### 数据结构

```typescript
interface ExamQuestion {
  id: string;
  character: string;        // 考察的字
  definition: string;       // 该字的义项
  options: ExamOption[];    // 选项列表
  correctAnswer: 'A' | 'B' | 'C' | 'D';
}

interface ExamOption {
  label: 'A' | 'B' | 'C' | 'D';
  sentence: string;         // 例句
  isSameDefinition: boolean; // 是否与题目义项相同
}
```

### 性能优化

- AI 请求分批处理，避免超时
- 并发控制，避免请求过快
- 自动重试失败的请求
- 缓存已生成的义项

## 未来计划

1. **Word 导出功能**
   - 完整的文档格式
   - 自动排版
   - 答案页

2. **更多题型**
   - 找出相同义项
   - 多选题
   - 填空题
   - 翻译题

3. **题库管理**
   - 保存生成的题目
   - 题目分类
   - 题目编辑

4. **批量操作**
   - 批量生成多套试卷
   - 批量导出
   - 批量打印

5. **智能推荐**
   - 根据学生水平推荐题目
   - 错题分析
   - 知识点覆盖分析

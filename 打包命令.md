# ğŸ“¦ æ‰“åŒ…å‘½ä»¤é€ŸæŸ¥è¡¨

## ğŸš€ å¿«é€Ÿæ‰“åŒ…ï¼ˆæ¨èï¼‰

### ä¸€é”®æ‰“åŒ…ï¼ˆåŒ…å«é¢„è®¾é…ç½®ï¼‰

```bash
npm run build:with-config
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
1. âœ… éªŒè¯é…ç½®æ–‡ä»¶
2. âœ… ç”Ÿæˆå®‰è£…ç¨‹åºå›¾ç‰‡
3. âœ… æ„å»º Next.js åº”ç”¨
4. âœ… å¤åˆ¶é…ç½®æ–‡ä»¶
5. âœ… æ‰“åŒ… Electron åº”ç”¨
6. âœ… ç”Ÿæˆå®‰è£…ç¨‹åº

---

## ğŸ“‹ åˆ†æ­¥æ‰“åŒ…å‘½ä»¤

### 1. éªŒè¯é…ç½®æ–‡ä»¶

```bash
npm run verify:config
```

æ£€æŸ¥ `dist/config-custom-*.json` æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ã€‚

### 2. ç”Ÿæˆå®‰è£…ç¨‹åºå›¾ç‰‡

```bash
npm run generate:images
```

ç”Ÿæˆï¼š
- `build/installerHeader.bmp` (150x57)
- `build/installerSidebar.bmp` (164x314)

### 3. æ„å»º Next.js åº”ç”¨

```bash
npm run build
```

ç”Ÿæˆé™æ€ç½‘ç«™åˆ° `out/` ç›®å½•ã€‚

### 4. å¤åˆ¶é…ç½®æ–‡ä»¶

```bash
# Windows CMD
copy dist\config-custom-*.json out\default-config.json

# Windows PowerShell
Copy-Item "dist\config-custom-*.json" -Destination "out\default-config.json"
```

### 5. æ‰“åŒ… Electron åº”ç”¨

```bash
# æ‰“åŒ… Windows ç‰ˆæœ¬ï¼ˆx64 + ia32ï¼‰
npm run electron:build:win

# æˆ–ä½¿ç”¨ npx
npx electron-builder --win --x64 --ia32
```

---

## ğŸ¯ ç‰¹å®šå¹³å°æ‰“åŒ…

### ä»…æ‰“åŒ… 64 ä½

```bash
npx electron-builder --win --x64
```

ç”Ÿæˆï¼š
- `æ–‡è¨€æ–‡å·¥å…·-1.0.0-x64-Setup.exe`

### ä»…æ‰“åŒ… 32 ä½

```bash
npx electron-builder --win --ia32
```

ç”Ÿæˆï¼š
- `æ–‡è¨€æ–‡å·¥å…·-1.0.0-ia32-Setup.exe`

### æ‰“åŒ…ä¾¿æºç‰ˆ

```bash
npm run electron:build:portable
```

ç”Ÿæˆï¼š
- `æ–‡è¨€æ–‡å·¥å…·-1.0.0-x64-Portable.exe`

---

## ğŸ§¹ æ¸…ç†å‘½ä»¤

### æ¸…ç†æ„å»ºæ–‡ä»¶

```bash
# Windows CMD
rmdir /s /q dist .next out

# Windows PowerShell
Remove-Item -Recurse -Force dist, .next, out
```

### æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–

```bash
# æ¸…ç†
rmdir /s /q node_modules

# é‡æ–°å®‰è£…
npm install
```

---

## ğŸ”§ å¼€å‘å‘½ä»¤

### å¼€å‘æ¨¡å¼

```bash
npm run dev
```

å¯åŠ¨ Next.js å¼€å‘æœåŠ¡å™¨ï¼ˆhttp://localhost:3000ï¼‰

### Electron å¼€å‘æ¨¡å¼

```bash
npm run electron:dev
```

åŒæ—¶å¯åŠ¨ Next.js å’Œ Electron

### æµ‹è¯•æ‰“åŒ…ï¼ˆä¸ç”Ÿæˆå®‰è£…ç¨‹åºï¼‰

```bash
npm run pack
```

åªæ‰“åŒ…åº”ç”¨ï¼Œä¸ç”Ÿæˆå®‰è£…ç¨‹åºï¼Œç”¨äºå¿«é€Ÿæµ‹è¯•ã€‚

---

## ğŸ“Š å®Œæ•´æ‰“åŒ…æµç¨‹

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬

```bash
# 1. åœ¨åº”ç”¨ä¸­å¯¼å‡ºé…ç½®
#    è®¾ç½® â†’ ğŸ’¾ å¯¼å‡ºå…¨éƒ¨ â†’ ä¿å­˜åˆ° dist/

# 2. è¿è¡Œæ‰“åŒ…è„šæœ¬
npm run build:with-config

# 3. ç­‰å¾…å®Œæˆï¼ˆçº¦ 5-10 åˆ†é’Ÿï¼‰

# 4. æŸ¥çœ‹ç»“æœ
dir dist\*.exe
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ†æ­¥æ‰§è¡Œ

```bash
# 1. éªŒè¯é…ç½®
npm run verify:config

# 2. ç”Ÿæˆå›¾ç‰‡
npm run generate:images

# 3. æ¸…ç†æ—§æ–‡ä»¶
rmdir /s /q .next out

# 4. æ„å»ºåº”ç”¨
npm run build

# 5. å¤åˆ¶é…ç½®
copy dist\config-custom-*.json out\default-config.json

# 6. æ‰“åŒ…
npx electron-builder --win --x64 --ia32

# 7. å®Œæˆï¼
dir dist\*.exe
```

---

## ğŸ¨ è‡ªå®šä¹‰æ‰“åŒ…

### ä¿®æ”¹åº”ç”¨åç§°

ç¼–è¾‘ `package.json`:

```json
{
  "build": {
    "productName": "ä½ çš„åº”ç”¨åç§°"
  }
}
```

### ä¿®æ”¹ç‰ˆæœ¬å·

ç¼–è¾‘ `package.json`:

```json
{
  "version": "1.0.1"
}
```

### ä¿®æ”¹å›¾æ ‡

æ›¿æ¢æ–‡ä»¶ï¼š
- `build/icon.ico` - åº”ç”¨å›¾æ ‡

### ä¿®æ”¹å®‰è£…ç¨‹åºå›¾ç‰‡

æ›¿æ¢æ–‡ä»¶ï¼š
- `build/installerHeader.bmp` (150x57)
- `build/installerSidebar.bmp` (164x314)

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
dir dist\config-custom-*.json

# å¦‚æœä¸å­˜åœ¨ï¼Œåœ¨åº”ç”¨ä¸­é‡æ–°å¯¼å‡º
```

### é—®é¢˜ï¼šæ‰“åŒ…å¤±è´¥

```bash
# 1. æ¸…ç†æ‰€æœ‰æ„å»ºæ–‡ä»¶
rmdir /s /q dist .next out

# 2. é‡æ–°å®‰è£…ä¾èµ–
npm install

# 3. é‡æ–°æ‰“åŒ…
npm run build:with-config
```

### é—®é¢˜ï¼šelectron-builder æ‰¾ä¸åˆ°

```bash
# é‡æ–°å®‰è£… electron-builder
npm install electron-builder --save-dev
```

### é—®é¢˜ï¼šå†…å­˜ä¸è¶³

```bash
# å¢åŠ  Node.js å†…å­˜é™åˆ¶
set NODE_OPTIONS=--max-old-space-size=4096
npm run build:with-config
```

---

## ğŸ“ package.json ä¸­çš„æ‰€æœ‰æ‰“åŒ…ç›¸å…³å‘½ä»¤

```json
{
  "scripts": {
    "build": "next build",
    "electron:build": "npm run build && electron-builder",
    "electron:build:win": "npm run build && electron-builder --win --x64 --ia32",
    "electron:build:portable": "npm run build && electron-builder --win portable --x64",
    "build:with-config": "node scripts/build-with-config.js",
    "verify:config": "node scripts/verify-config.js",
    "generate:images": "node build/generate-simple-images.js",
    "pack": "npm run build && electron-builder --dir"
  }
}
```

---

## ğŸ¯ æ¨èå·¥ä½œæµ

### æ—¥å¸¸å¼€å‘

```bash
npm run dev
```

### æµ‹è¯•æ‰“åŒ…

```bash
npm run pack
```

### æ­£å¼å‘å¸ƒ

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
# ç¼–è¾‘ package.json ä¸­çš„ version

# 2. å¯¼å‡ºæœ€æ–°é…ç½®
# åœ¨åº”ç”¨ä¸­ï¼šè®¾ç½® â†’ ğŸ’¾ å¯¼å‡ºå…¨éƒ¨

# 3. æ‰“åŒ…
npm run build:with-config

# 4. æµ‹è¯•å®‰è£…ç¨‹åº
.\dist\æ–‡è¨€æ–‡å·¥å…·-1.0.0-x64-Setup.exe

# 5. åˆ†å‘
# ä¸Šä¼ åˆ°äº‘ç›˜æˆ–ç½‘ç«™
```

---

## ğŸ“¦ è¾“å‡ºæ–‡ä»¶è¯´æ˜

æ‰“åŒ…å®Œæˆåï¼Œ`dist/` ç›®å½•åŒ…å«ï¼š

```
dist/
â”œâ”€â”€ æ–‡è¨€æ–‡å·¥å…·-1.0.0-x64-Setup.exe      # 64ä½å®‰è£…ç¨‹åºï¼ˆæ¨èï¼‰
â”œâ”€â”€ æ–‡è¨€æ–‡å·¥å…·-1.0.0-ia32-Setup.exe     # 32ä½å®‰è£…ç¨‹åº
â”œâ”€â”€ æ–‡è¨€æ–‡å·¥å…·-1.0.0-Setup.exe          # é€šç”¨å®‰è£…ç¨‹åº
â”œâ”€â”€ æ–‡è¨€æ–‡å·¥å…·-1.0.0-x64-Portable.exe   # ä¾¿æºç‰ˆ
â”œâ”€â”€ *.blockmap                           # æ›´æ–°æ–‡ä»¶
â”œâ”€â”€ latest.yml                           # æ›´æ–°é…ç½®
â””â”€â”€ win-unpacked/                        # æœªæ‰“åŒ…çš„åº”ç”¨ï¼ˆç”¨äºè°ƒè¯•ï¼‰
```

---

## ğŸ’¡ æç¤º

1. **é¦–æ¬¡æ‰“åŒ…**ï¼šä½¿ç”¨ `npm run build:with-config`
2. **å¿«é€Ÿæµ‹è¯•**ï¼šä½¿ç”¨ `npm run pack`
3. **æ¸…ç†é‡å»º**ï¼šå…ˆåˆ é™¤ `dist .next out`ï¼Œå†æ‰“åŒ…
4. **é…ç½®æ›´æ–°**ï¼šé‡æ–°å¯¼å‡ºé…ç½®ï¼Œé‡æ–°æ‰“åŒ…
5. **ç‰ˆæœ¬æ›´æ–°**ï¼šä¿®æ”¹ `package.json` ä¸­çš„ `version`

---

## ğŸ‰ å¿«é€Ÿå‚è€ƒ

| å‘½ä»¤ | ç”¨é€” | æ—¶é—´ |
|------|------|------|
| `npm run verify:config` | éªŒè¯é…ç½® | 1ç§’ |
| `npm run generate:images` | ç”Ÿæˆå›¾ç‰‡ | 1ç§’ |
| `npm run build` | æ„å»ºåº”ç”¨ | 2-3åˆ†é’Ÿ |
| `npm run electron:build:win` | æ‰“åŒ…å®‰è£…ç¨‹åº | 3-5åˆ†é’Ÿ |
| `npm run build:with-config` | ä¸€é”®å®Œæˆæ‰€æœ‰ | 5-10åˆ†é’Ÿ |

---

**æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼š**

```bash
npm run build:with-config
```

å°±è¿™ä¸€ä¸ªå‘½ä»¤ï¼Œæå®šæ‰€æœ‰ï¼ğŸš€

# 义项整理系统使用指南

## 功能概述

义项整理系统已经重写，支持以下新功能：

### 1. 自定义范围查看
- 可以选择特定的库、集或文章来查看义项
- 只显示选定范围内的义项和例句
- 支持全局查看（不选择任何范围）

### 2. 优化的思维导图布局
- 智能缩放：根据义项和例句数量自动调整缩放比例
- 折叠机制：当一个义项的例句超过5个时，自动折叠多余的例句
- 紧凑布局：当义项很多时使用更紧凑的布局，避免图表过大

### 3. PNG导出功能
- 一键导出思维导图为高清PNG图片
- 自动命名：`mindmap-字-时间戳.png`
- 2倍分辨率，确保导出质量

## 使用方法

### 访问页面
访问 `/organize` 路由即可使用义项整理系统

### 基本操作流程

1. **选择范围（可选）**
   - 在左侧边栏选择要查看的库
   - 可进一步选择集或文章
   - 不选择则查看全部范围

2. **选择字符**
   - 在输入框中输入一个字
   - 或从下方的字符列表中点击选择
   - 字符列表显示所有有义项的字

3. **生成思维导图**
   - 点击"生成思维导图"按钮
   - 系统会根据选定范围生成思维导图
   - 如果该字在选定范围内没有义项，会提示

4. **查看和操作**
   - 使用鼠标拖动画布移动视图
   - 使用鼠标滚轮缩放
   - 点击"重置视图"恢复初始状态
   - 点击"导出PNG"保存图片

5. **保存思维导图**
   - 点击"保存思维导图"按钮
   - 保存当前的布局和视图状态

## 思维导图说明

### 节点类型

1. **中心节点（蓝色圆形）**
   - 显示当前查看的字
   - 位于图表中心

2. **义项节点（橙色圆角矩形）**
   - 显示该字的各个义项
   - 按例句数量从多到少排列

3. **例句节点（紫色矩形）**
   - 显示具体的例句
   - 连接到对应的义项

4. **折叠节点（灰色虚线框）**
   - 显示"+N 更多"
   - 表示还有更多例句被折叠
   - 点击可展开（功能待实现）

### 连接线

- **蓝色实线**：中心字到义项的连接
- **橙色实线**：义项到例句的连接
- **灰色虚线**：义项到折叠节点的连接

## 性能优化

### 自动缩放策略

系统会根据内容量自动调整缩放：

- 义项 > 30 或 例句 > 150：缩放 40%
- 义项 > 20 或 例句 > 100：缩放 50%
- 义项 > 15 或 例句 > 60：缩放 60%
- 义项 > 10 或 例句 > 30：缩放 70%
- 义项 > 5 或 例句 > 15：缩放 80%
- 其他情况：缩放 100%

### 折叠机制

- 每个义项最多显示 5 个例句
- 超过 5 个的例句会被折叠
- 折叠节点显示剩余例句数量

## 技术细节

### 新增功能

1. **范围过滤**
   - `MindMapService.generateMindMap()` 新增 `scope` 参数
   - 支持按库、集、文章过滤义项和例句

2. **折叠节点**
   - 新增 `collapse` 节点类型
   - 配置 `maxExamplesPerDefinition = 5`

3. **PNG导出**
   - 使用 `html2canvas` 库
   - 2倍分辨率导出
   - 自动下载

### 数据结构更新

```typescript
// MindMapNode 新增字段
interface MindMapNode {
  // ... 原有字段
  collapsed?: boolean
  childrenIds?: string[]
}

// MindMapData 新增字段
interface MindMapData {
  // ... 原有字段
  scope?: {
    libraryId?: string
    collectionId?: string
    articleId?: string
  }
}
```

## 未来改进

1. **展开折叠节点**
   - 点击折叠节点可以展开显示所有例句
   - 支持动态添加/移除节点

2. **更多导出格式**
   - 支持导出为 SVG
   - 支持导出为 PDF

3. **自定义样式**
   - 允许用户自定义节点颜色
   - 允许用户自定义字体大小

4. **搜索和过滤**
   - 在思维导图中搜索特定例句
   - 按来源文章过滤显示

5. **协作功能**
   - 支持分享思维导图链接
   - 支持导出为可编辑格式

# AI义项整理功能说明

## 新增功能

### 1. AI义项整理页面 (`/ai-organize`)
- **功能**：AI自动分析文言文库中的句子，识别重点字并生成义项
- **工作流程**：
  - 第一轮：AI识别每个句子中需要制作义项的重点字（实词、虚词、通假字等）
  - 第二轮：为每个字生成对应的义项解释
  - 自动关联例句：生成的义项会自动关联到原句子作为例句
- **范围选择**：
  - 可以选择处理全部库，或指定某个库
  - 可以进一步选择某个集
  - 可以精确到某篇文章
  - 灵活控制处理范围，节省时间
- **访问方式**：侧边栏 → AI义项整理

### 2. 义项库管理 (`/manage/definitions`)
- **功能**：集中管理所有AI生成和手动添加的义项
- **特性**：
  - 按字分组显示所有义项
  - 支持搜索字或义项内容
  - 支持编辑义项内容
  - 支持删除义项
  - 显示统计信息（总义项数、字数）
- **访问方式**：编辑库页面 → 义项库面板 → 点击编辑按钮

### 3. 文言文短句库 (`/manage/short-sentences`)
- **功能**：AI自动从文言文库生成适合出题的短句
- **生成规则**：
  - 按逗号、顿号等标点符号分割长句
  - 只保留长短适中（4-15字）且结构完整的短句
  - 太短的短句（1-3字）自动过滤，如"饮水"
  - 长句（15字以上）直接保留，如"如使人之所欲莫甚于生"
  - 保留有完整语法结构的短句，如"乐亦在其中矣"
- **特性**：
  - AI自动生成短句库
  - 支持搜索短句
  - 支持手动删除不合适的短句
  - 文言文库更新时可重新生成
- **访问方式**：编辑库页面 → 短句库面板 → 点击编辑按钮

## 使用流程

### 首次使用
1. 导入文言文库（导入数据页面）
2. 运行AI义项整理（AI义项整理页面）
3. 生成短句库（短句库管理页面）

### 日常使用
1. 在义项库中查看和编辑AI生成的义项
2. 在短句库中管理用于出题的短句
3. 文言文库更新后，重新运行AI义项整理和短句生成

## 数据结构

### 义项 (Definition)
```typescript
{
  id: string;
  character: string;        // 关联的字
  content: string;          // 义项内容
  createdAt: string;
  updatedAt: string;
}
```

### 短句 (ShortSentence)
```typescript
{
  id: string;
  text: string;             // 短句文本
  sourceArticleId: string;  // 来源文章ID
  sourceSentenceId: string; // 来源句子ID
  createdAt: string;
}
```

### 字-义项-句子关联 (CharacterDefinitionLink)
```typescript
{
  id: string;
  definitionId: string;     // 义项ID
  sentenceId: string;       // 例句ID
  characterPosition: number; // 字在句子中的位置
}
```

## 注意事项

1. **AI生成的义项**：
   - 现在会自动关联例句
   - 可以在义项库中手动编辑和删除
   - 重复运行不会产生重复义项

2. **短句库**：
   - 重新生成会清空现有短句库
   - 建议在文言文库稳定后再生成
   - 可以手动删除不合适的短句

3. **性能**：
   - AI处理需要时间，请耐心等待
   - 大量句子会分批处理，避免API限流
   - 进度条会实时显示处理进度


## 界面操作说明

### 义项整理页面 (`/organize`)
- **画布拖动**：在空白区域按住鼠标左键拖动，可以移动整个画布
- **节点拖动**：点击节点并拖动，可以调整节点位置
- **缩放**：使用鼠标滚轮可以缩放画布
- **保存**：点击右上角保存按钮保存当前布局

### AI义项整理页面 (`/ai-organize`)
- **范围选择**：
  1. 默认处理全部库
  2. 选择库后，可以进一步选择集
  3. 选择集后，可以进一步选择文章
  4. 每次选择会自动重置下级选项
- **处理进度**：
  - 显示当前处理阶段（第一轮/第二轮）
  - 显示处理进度条和数量
  - 处理完成后显示结果列表

## 性能优化

### 并发处理
- **第一轮（识别重点字）**：
  - 批次大小：30个句子/批次
  - 并发批次：5个批次同时处理
  - 理论提速：约7-8倍
  
- **第二轮（生成义项）**：
  - 并发数：10个请求同时处理
  - 理论提速：约3-4倍
  
- **短句生成**：
  - 并发数：8个请求同时处理
  - 理论提速：约4-5倍

### 处理时间估算
- 100个句子：约30-60秒
- 500个句子：约2-4分钟
- 1000个句子：约3-5分钟

## 常见问题

### Q: 义项整理页面无法拖动？
A: 现在支持画布拖动了！在空白区域按住鼠标左键拖动即可移动整个画布。

### Q: AI处理太慢怎么办？
A: 
1. 使用范围选择功能，只处理需要的部分
2. 系统已经优化了并发处理，速度提升了5-7倍
3. 可以分批处理，先处理重要的库或集

### Q: 如何避免重复生成义项？
A: 系统会自动检查是否已存在相同的义项（字+内容），不会产生重复。

### Q: 生成的义项不准确怎么办？
A: 可以在义项库管理页面手动编辑或删除不准确的义项。

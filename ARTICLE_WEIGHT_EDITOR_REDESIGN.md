# 文章加权编辑器重构文档

## 执行摘要

当前的文章加权编辑器（ArticleWeightEditor）是一个"区间选择工具"，用户需要通过拖拽在轴上标记区间来选择文章。这个设计存在以下问题：

1. **学习曲线陡峭** - 用户需要理解"区间"的概念
2. **反馈不足** - 操作后没有明确的结果提示
3. **功能不完整** - 缺少常见的编辑操作（全选、反选、清空等）
4. **信息不对称** - 用户不知道选中的文章有多少数据

本文档提出将其重构为一个**完整的文章加权编辑器**，提供多视图、多操作方式、充分的数据反馈。

---

## 第一部分：现状分析

### 当前功能

| 功能 | 实现状态 | 用户体验 |
|------|--------|--------|
| 库选择 | ✓ | 清晰 |
| 范围选择（拖拽） | ✓ | 需要学习 |
| 区间调整 | ✓ | 可用 |
| 区间删除 | ✓ | 可用 |
| 缩放视图 | ✓ | 可用 |
| 自动滚动 | ✓ | 隐形 |
| 权重设置 | ✗ | 不存在 |
| 快速操作 | ✗ | 不存在 |
| 数据统计 | ✗ | 不存在 |
| 搜索筛选 | ✗ | 不存在 |

### 用户痛点

#### 痛点1：不知道这个工具的作用
- **问题**：新用户看到轴视图，不知道这是干什么的
- **影响**：用户需要查看文档或询问才能理解
- **解决方案**：添加清晰的功能说明和使用提示

#### 痛点2：操作后没有反馈
- **问题**：用户拖拽创建区间后，不知道选中了哪些文章
- **影响**：用户不确定操作是否成功
- **解决方案**：显示"已选中X篇文章，共Y个句子"等统计信息

#### 痛点3：无法快速操作
- **问题**：用户想要全选所有文章，但需要手动拖拽
- **影响**：操作效率低
- **解决方案**：添加全选、反选、清空等快速操作按钮

#### 痛点4：不知道数据情况
- **问题**：用户不知道选中的文章有多少句子、义项
- **影响**：用户无法判断数据是否充足
- **解决方案**：显示详细的数据统计信息

#### 痛点5：无法调整权重
- **问题**：当前组件只能选择/取消选择，无法设置权重
- **影响**：用户无法控制文章的出现频率
- **解决方案**：添加权重滑块和快速设置

#### 痛点6：无法撤销操作
- **问题**：用户误操作后无法恢复
- **影响**：用户需要重新配置
- **解决方案**：添加撤销/重做功能

---

## 第二部分：用户场景分析

### 场景1：快速选择所有文章

**用户目标**：从整个库中出题

**当前流程**：
1. 选择库
2. 手动拖拽创建区间，覆盖所有文章
3. 确认选择

**问题**：需要手动拖拽，容易出错

**改进方案**：
1. 选择库
2. 点击"全选"按钮
3. 完成

**预期时间**：从30秒 → 3秒

---

### 场景2：选择特定范围的文章

**用户目标**：从第5-15篇文章中出题

**当前流程**：
1. 选择库
2. 拖拽创建区间，从第5篇到第15篇
3. 确认选择

**问题**：需要精确定位，容易出错

**改进方案**：
1. 选择库
2. 在列表视图中，点击第5篇文章
3. 按Shift+点击第15篇文章
4. 完成

**预期时间**：从20秒 → 5秒

---

### 场景3：排除某些文章

**用户目标**：从所有文章中出题，但排除某几篇

**当前流程**：
1. 选择库
2. 手动拖拽创建多个区间，避开要排除的文章
3. 确认选择

**问题**：无法直接实现，需要复杂的操作

**改进方案**：
1. 选择库
2. 点击"全选"按钮
3. 点击要排除的文章，取消选择
4. 完成

**预期时间**：从60秒 → 10秒

---

### 场景4：调整权重

**用户目标**：让某些文章出现的频率更高

**当前流程**：
1. 无法实现

**改进方案**：
1. 选择库
2. 在列表视图中，找到要调整的文章
3. 拖动权重滑块或输入权重值
4. 完成

**预期时间**：从不可能 → 10秒

---

### 场景5：了解数据情况

**用户目标**：知道选中的文章有多少数据

**当前流程**：
1. 无法看到

**改进方案**：
1. 选择库
2. 查看统计面板，显示"已选中X篇文章，共Y个句子，Z个义项"
3. 查看数据分布图表

**预期时间**：从不可能 → 1秒

---

## 第三部分：重构方案

### 总体架构

```
文章加权编辑器
├── 头部
│   ├── 库选择下拉框
│   ├── 快速操作按钮（全选、反选、清空、重置）
│   └── 视图切换按钮（轴视图、列表视图、统计视图）
├── 主体
│   ├── 轴视图（范围选择）
│   ├── 列表视图（详细编辑）
│   └── 统计视图（数据查看）
├── 侧边栏
│   ├── 统计面板
│   ├── 搜索框
│   └── 筛选器
└── 底部
    ├── 操作历史（撤销/重做）
    └── 帮助按钮
```

### 核心功能模块

#### 模块1：文章选择

**功能**：支持多种方式选择文章

**实现方式**：
- 单个选择：点击文章，切换选中状态
- 范围选择：拖拽轴视图中的区间
- 全选：点击"全选"按钮
- 反选：点击"反选"按钮
- 清空：点击"清空"按钮
- 按集选择：点击集名称，选中该集的所有文章
- 快捷键：Ctrl+A（全选）、Ctrl+Shift+A（反选）、Delete（清空）

**UI设计**：
```
┌─────────────────────────────────────────┐
│ 全选 | 反选 | 清空 | 重置 | 帮助        │
├─────────────────────────────────────────┤
│ 轴视图 | 列表视图 | 统计视图            │
├─────────────────────────────────────────┤
│ [轴视图内容]                            │
│ 或                                      │
│ [列表视图内容]                          │
│ 或                                      │
│ [统计视图内容]                          │
└─────────────────────────────────────────┘
```

---

#### 模块2：权重设置

**功能**：为每篇文章设置权重（0-100）

**权重含义**：
- 0：完全排除，不参与出题
- 1-49：低权重，出现频率低
- 50：中等权重，平均分布
- 51-99：高权重，出现频率高
- 100：最高权重，优先出题

**实现方式**：
- 权重滑块：拖动滑块调整权重
- 权重输入框：直接输入权重值
- 权重预设：快速设置（0%, 25%, 50%, 75%, 100%）
- 批量设置：选中多篇文章，批量设置权重

**UI设计**：
```
文章列表
┌─────────────────────────────────────────────────┐
│ 文章名称 | 句子数 | 义项数 | 权重 | 选中状态    │
├─────────────────────────────────────────────────┤
│ 岳阳楼记 | 45    | 12    | [====●====] 50% | ☑ │
│ 醉翁亭记 | 38    | 10    | [●=========] 10% | ☐ │
│ 桃花源记 | 52    | 15    | [=========●] 90% | ☑ │
└─────────────────────────────────────────────────┘
```

---

#### 模块3：数据统计

**功能**：显示选中文章的数据统计

**统计内容**：
- 已选中文章数
- 总句子数
- 总义项数
- 平均每篇文章的句子数
- 平均每篇文章的义项数
- 数据充足度（绿/黄/红）
- 预计可生成题目数

**UI设计**：
```
统计面板
┌──────────────────────────┐
│ 📊 统计信息              │
├──────────────────────────┤
│ 已选中文章：8 篇         │
│ 总句子数：320 个         │
│ 总义项数：85 个          │
│ 平均句子数：40 个/篇     │
│ 平均义项数：10.6 个/篇   │
│ 数据充足度：✓ 充足       │
│ 预计题目数：15-20 道     │
└──────────────────────────┘
```

---

#### 模块4：快速操作

**功能**：提供常用操作的快捷方式

**操作列表**：
- 全选：选中所有文章
- 反选：反转选中状态
- 清空：取消选中所有文章
- 重置：恢复默认配置
- 导入：从文件导入配置
- 导出：保存配置到文件

**UI设计**：
```
工具栏
┌─────────────────────────────────────────┐
│ [全选] [反选] [清空] [重置] | [导入] [导出] │
└─────────────────────────────────────────┘
```

---

#### 模块5：搜索和筛选

**功能**：快速找到特定文章

**搜索方式**：
- 文章标题搜索：输入文章名称，实时筛选
- 按集筛选：选择集，只显示该集的文章
- 按数据量筛选：显示数据量在指定范围内的文章
- 按选中状态筛选：只显示已选中/未选中的文章

**UI设计**：
```
搜索和筛选
┌──────────────────────────────────────────┐
│ 搜索: [输入文章名称...] 🔍               │
├──────────────────────────────────────────┤
│ 按集筛选: [所有集 ▼]                     │
│ 按数据量: [最少 ▼] - [最多 ▼]           │
│ 按状态: [全部 ▼]                        │
└──────────────────────────────────────────┘
```

---

#### 模块6：操作历史

**功能**：支持撤销/重做操作

**实现方式**：
- 撤销：Ctrl+Z，恢复上一步操作
- 重做：Ctrl+Y，重新执行已撤销的操作
- 操作日志：显示最近的操作历史
- 恢复默认：一键恢复初始配置

**UI设计**：
```
操作历史
┌──────────────────────────┐
│ [↶ 撤销] [↷ 重做]        │
├──────────────────────────┤
│ 最近操作：                │
│ 1. 选中"岳阳楼记"        │
│ 2. 设置权重为75%         │
│ 3. 取消选中"醉翁亭记"    │
└──────────────────────────┘
```

---

#### 模块7：多视图支持

**视图1：轴视图**
- 用途：范围选择
- 特点：紧凑、支持拖拽、支持缩放
- 适合：快速选择连续的文章

**视图2：列表视图**
- 用途：详细编辑
- 特点：清晰、支持排序、支持搜索
- 适合：精细调整和权重编辑

**视图3：统计视图**
- 用途：数据查看
- 特点：直观、支持图表、支持导出
- 适合：了解数据分布和充足度

**视图切换**：
```
┌─────────────────────────────────────────┐
│ [轴视图] [列表视图] [统计视图]          │
└─────────────────────────────────────────┘
```

---

#### 模块8：帮助系统

**功能**：帮助用户快速上手

**帮助内容**：
- 新手引导：首次使用时显示
- 工具提示：鼠标悬停时显示
- 快捷键帮助：显示所有快捷键
- 常见问题：FAQ列表
- 使用说明：详细的操作指南

**UI设计**：
```
帮助按钮
┌──────────────────────────┐
│ [?] 帮助                 │
├──────────────────────────┤
│ 新手引导                 │
│ 快捷键帮助               │
│ 常见问题                 │
│ 使用说明                 │
└──────────────────────────┘
```

---

## 第四部分：详细设计

### 4.1 轴视图改进

**当前问题**：
- 信息密度低
- 反馈不足
- 难以理解

**改进方案**：
1. 添加文章数据提示
   - 鼠标悬停时显示文章名称、句子数、义项数
   
2. 改进视觉反馈
   - 已选中的文章用不同颜色标记
   - 权重用颜色深度表示
   - 数据不足的文章用警告标记
   
3. 添加快速操作
   - 右键菜单：选中/取消选中、设置权重
   - 双击：快速选中/取消选中
   - Shift+点击：范围选择

**UI设计**：
```
轴视图
┌─────────────────────────────────────────┐
│ 文章轴                                  │
│ ┌─────────────────────────────────────┐ │
│ │ ●  ●  ●  ◐  ◐  ◑  ○  ○  ○  ○  ○  │ │
│ │ 1  2  3  4  5  6  7  8  9  10 11 │ │
│ └─────────────────────────────────────┘ │
│ 图例：● 已选中 ◐ 部分选中 ○ 未选中     │
│ 颜色深度表示权重：深=高权重 浅=低权重   │
└─────────────────────────────────────────┘
```

---

### 4.2 列表视图设计

**功能**：显示所有文章的详细信息

**列信息**：
- 序号：文章在库中的位置
- 文章名称：可点击，显示详细信息
- 集名称：所属的集
- 句子数：该文章的句子总数
- 义项数：该文章的义项总数
- 权重：权重滑块或输入框
- 选中状态：复选框

**交互**：
- 点击行：切换选中状态
- 拖动权重滑块：调整权重
- 输入权重值：直接设置权重
- 右键菜单：快速操作
- 排序：点击列头排序
- 搜索：实时筛选

**UI设计**：
```
列表视图
┌────┬──────────┬────┬────┬────┬──────┬──┐
│ # │ 文章名称 │ 集 │ 句 │ 义 │ 权重 │ ☑ │
├────┼──────────┼────┼────┼────┼──────┼──┤
│ 1  │ 岳阳楼记 │ 古 │ 45 │ 12 │ [●] │ ☑ │
│ 2  │ 醉翁亭记 │ 古 │ 38 │ 10 │ [○] │ ☐ │
│ 3  │ 桃花源记 │ 古 │ 52 │ 15 │ [◐] │ ☑ │
│ 4  │ 兰亭集序 │ 古 │ 41 │ 11 │ [●] │ ☑ │
│ 5  │ 滕王阁序 │ 古 │ 48 │ 13 │ [○] │ ☐ │
└────┴──────────┴────┴────┴────┴──────┴──┘
```

---

### 4.3 统计视图设计

**功能**：显示数据分布和充足度

**内容**：
1. 总体统计
   - 已选中文章数
   - 总句子数
   - 总义项数
   - 平均数据量

2. 数据分布
   - 按文章的句子数分布
   - 按文章的义项数分布
   - 按权重分布

3. 充足度评估
   - 数据是否充足
   - 预计可生成题目数
   - 建议

**UI设计**：
```
统计视图
┌──────────────────────────────────────────┐
│ 📊 统计信息                              │
├──────────────────────────────────────────┤
│ 已选中文章：8 篇                         │
│ 总句子数：320 个                         │
│ 总义项数：85 个                          │
│ 平均句子数：40 个/篇                     │
│ 平均义项数：10.6 个/篇                   │
│ 数据充足度：✓ 充足                       │
│ 预计题目数：15-20 道                     │
├──────────────────────────────────────────┤
│ 📈 数据分布                              │
│ 句子数分布：[████████░░░░░░░░░░]         │
│ 义项数分布：[██████░░░░░░░░░░░░░░]       │
│ 权重分布：[███░░░░░░░░░░░░░░░░░░░░]     │
└──────────────────────────────────────────┘
```

---

### 4.4 快捷键设计

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| Ctrl+A | 全选 | 选中所有文章 |
| Ctrl+Shift+A | 反选 | 反转选中状态 |
| Delete | 清空 | 取消选中所有文章 |
| Ctrl+Z | 撤销 | 恢复上一步操作 |
| Ctrl+Y | 重做 | 重新执行已撤销的操作 |
| Ctrl+S | 保存 | 保存当前配置 |
| Ctrl+O | 打开 | 打开已保存的配置 |
| ? | 帮助 | 显示帮助信息 |

---

## 第五部分：实现优先级

### 第一阶段（MVP）- 核心功能
- [ ] 改进轴视图的视觉反馈
- [ ] 添加快速操作按钮（全选、反选、清空）
- [ ] 添加统计面板
- [ ] 添加权重滑块

**预期工作量**：2-3周

---

### 第二阶段 - 列表视图
- [ ] 实现列表视图
- [ ] 支持排序和搜索
- [ ] 支持单个权重编辑
- [ ] 支持批量操作

**预期工作量**：2-3周

---

### 第三阶段 - 高级功能
- [ ] 实现统计视图
- [ ] 添加操作历史（撤销/重做）
- [ ] 添加配置管理（保存/加载）
- [ ] 添加帮助系统

**预期工作量**：2-3周

---

## 第六部分：用户体验指标

### 可用性指标
- 新用户首次使用时间：< 5分钟
- 常见操作完成时间：< 30秒
- 错误率：< 5%
- 用户满意度：> 4/5

### 性能指标
- 页面加载时间：< 2秒
- 操作响应时间：< 500ms
- 支持文章数量：> 1000篇
- 内存占用：< 50MB

### 功能完整性
- 支持的操作方式：> 5种
- 支持的视图：> 2种
- 快捷键数量：> 5个
- 帮助内容：> 10项

---

## 第七部分：常见问题

### Q1：为什么要重构？
**A**：当前的轴视图设计学习曲线陡峭，用户需要理解"区间"的概念。重构后将提供多种操作方式，降低学习成本，提高用户体验。

### Q2：会不会破坏现有功能？
**A**：不会。重构会保留所有现有功能，并添加新功能。用户可以继续使用熟悉的操作方式。

### Q3：什么时候可以使用新功能？
**A**：分阶段实现。第一阶段（MVP）预计2-3周完成，包括快速操作和统计面板。

### Q4：如何迁移现有配置？
**A**：新系统会自动兼容旧配置。用户无需手动迁移。

### Q5：是否支持导入/导出？
**A**：是的。第三阶段会添加配置管理功能，支持保存和加载配置。

---

## 第八部分：成功标准

### 功能完整性
- ✓ 支持多种文章选择方式
- ✓ 支持权重设置
- ✓ 显示数据统计信息
- ✓ 提供快速操作
- ✓ 支持撤销/重做

### 用户体验
- ✓ 新用户可以在5分钟内上手
- ✓ 常见操作可以在30秒内完成
- ✓ 用户满意度 > 4/5
- ✓ 错误率 < 5%

### 性能指标
- ✓ 页面加载时间 < 2秒
- ✓ 操作响应时间 < 500ms
- ✓ 支持 > 1000篇文章
- ✓ 内存占用 < 50MB

---

## 附录：参考资源

### 相关组件
- ArticleWeightChart：权重曲线图表
- CharacterWeightEditor：重点字权重编辑器
- ExamStatistics：题目统计模块

### 相关文档
- ARTICLE_RANGE_SELECTOR_GUIDE.md：区间选择器使用指南
- EXAM_STATISTICS_GUIDE.md：题目统计功能指南

### 设计参考
- 表格组件：支持排序、搜索、筛选
- 滑块组件：权重调整
- 统计图表：数据可视化
- 快捷键系统：提高操作效率

---

## 结论

通过本次重构，文章加权编辑器将从一个"区间选择工具"转变为一个"完整的文章加权编辑器"，提供：

1. **更低的学习成本** - 多种操作方式，新手也能快速上手
2. **更高的操作效率** - 快速操作、快捷键、批量编辑
3. **更好的用户反馈** - 详细的统计信息、清晰的视觉反馈
4. **更完整的功能** - 权重设置、操作历史、配置管理

这将显著提升用户体验，使用户能够更有效地配置出题参数。
